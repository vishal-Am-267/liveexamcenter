<nav class="navbar navbar-expand-lg navbar-light bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <img src="/assets/images/logo.svg" alt="" width="100" height="24">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" [routerLink]="['/question']"
                        routerLinkActive="router-link-active" style="color: moccasin;">Question</a>
                </li>

            </ul>
        </div>
    </div>
</nav>

<div class="container mt-5">
    <div class="card">
        <div class="card-header pb-3">Add Question</div>
        <form action=""  [formGroup]="addMoreOption" (ngSubmit)="onSubmit()">
            <div class="card-body">




                <div class="row">
                    <div class="col">
                        <label class="form-label">Select Subject</label>
                        <ng-select [(ngModel)]="subject" name="subject" class="col-md-4 form-control"
                            style="border: none;" (change)="topicList()" placeholder="type to search subject..." formControlName="subject">
                            <ng-option *ngFor="let subject of subjectArr" [value]="subject._id"> {{subject.name}}
                            </ng-option>
                        </ng-select>
                        <span *ngIf="!addMoreOption.get('subject')!.valid && addMoreOption.get('subject')!.touched">please select one subject</span>
                    </div>




                    <div class="col">
                        <label class="form-label">Select Topics</label>
                        <ng-select name="topic" formControlName="topic" placeholder="type to search topic..."  class="col-md-4 form-control" style="border: none;">
                            <ng-option *ngFor="let topic of topicArr" [value]="topic._id">{{topic.name}}</ng-option>
                        </ng-select>
                        <span *ngIf="!addMoreOption.get('topic')!.valid && addMoreOption.get('topic')!.touched">please select one topic</span>
                    </div>
                </div>
                



                <div class="row">
                    <div class="col">
                        <label class="form-label">Question Type</label>
                        <ng-select  class="col-md-4 form-control" formControlName="type" [(ngModel)]="type" name="type" style="border: none;">
                            <ng-option *ngFor="let type of questionType" [value]="type.name"> {{type.name}}</ng-option>
                        </ng-select>
                        <span *ngIf="!addMoreOption.get('type')!.valid && addMoreOption.get('type')!.touched">please select one question type</span>
                    </div>

                    <div class="col">
                        <label class="form-label">Difficulty Level</label>
                        <ng-select  class="col-md-4 form-control" formControlName="diffLevel" style="border: none;">
                            <ng-option *ngFor="let level of difficultyLevel" [value]="level.name" selected>{{level.name}}
                            </ng-option>
                        </ng-select>
                        <span *ngIf="!addMoreOption.get('diffLevel')!.valid && addMoreOption.get('diffLevel')!.touched">please select one difficulty level</span>
                    </div>

                    <div class="col">
                        <label class="form-label">Right Marks</label>
                        <input type="number" class="form-control" formControlName = "rightMarks" 
                           >
                           <span *ngIf="!addMoreOption.get('rightMarks')!.valid && addMoreOption.get('rightMarks')!.touched">Please enter a valid right mark</span>
                    </div>

                    <div class="col">
                        <label class="form-label">Wrong Marks</label>
                        <input type="number" class="form-control" formControlName="wrongMarks" 
                            >
                            <span *ngIf="!addMoreOption.get('wrongMarks')!.valid && addMoreOption.get('wrongMarks')!.touched">Please enter a valid wrong mark</span>
                    </div>
                </div>




                <div class="row">
                    <label class="form-label">Question</label>
                    <div class="col" *ngIf="isSelected">
                        <textarea class="form-control" formControlName="questionText" aria-label="With textarea" rows="6" ></textarea>
                        
                    </div>

                    <quill-editor  *ngIf="!isSelected" formControlName="questionText" [styles]="{height : '200px'}"
                        (onEditorChanged)="changedEditor($event)">
                        <!-- <span *ngIf="!addMoreOption.get('subject')!.valid && addMoreOption.get('subject')!.touched">please select one subject</span> -->
                    </quill-editor>
                    <a style="color: grey; cursor: pointer;" (click)="changeEditor()" #enable>Enable rich editor</a>
                    <span *ngIf="!addMoreOption.get('questionText')!.valid && addMoreOption.get('questionText')!.touched">Question is required</span>
                </div>





                <label class="form-label">Options</label>
                <div formArrayName = 'options'>
                    <div  class="row" *ngFor="let option of formArr.controls; let i=index"   >
                        <div class="col input-group mb-3" [formGroupName]="i">
                            <div class="input-group-text ">
                                <!--  -->
                                    <input *ngIf="type === 'MULTIPLE RESPONSE'; else multipleChoice" class="form-check-input mx-2" 
                                    type="checkbox" value="" id="flexCheckDefault"  (change)="onSelect($event, i)" >
                                <ng-template #multipleChoice>
                                    <input  class="form-check-input me-1 px-2" name="isCorrect" formControlName="isCorrect" type="radio"  
                                    aria-label="Radio button for following text input" [checked]="" (change)="onSelect($event, i)" value="true">
                                </ng-template>
                                Option {{i+1}}
                            </div>
    
                            <textarea *ngIf = "!hiddenItems[i]"  class="form-control" formControlName="option" aria-label="With textarea" rows="4"
                                name="option">
                            </textarea>
    
                            <quill-editor *ngIf = "hiddenItems[i]"  formControlName="option" [styles]="{height : '80px'}"
                                (onEditorChanged)="changedEditor($event)">
                            </quill-editor>
                            
                        </div>
                        <div class="row" style="display: inline;">
                            <a  style="color: grey;  cursor: pointer;" [id]="i + 1" (click)="hiddenItems[i] = !hiddenItems[i]">Enable rich
                                editor </a>
                                
                            <a  style="color: grey; cursor: pointer;" (click)="removeOption(i)">Remove option</a>
                        </div>
                        
    
                    </div>

                </div>
          


                <button class="btn  float-start mt-3" style="border: none; color: rgb(46, 170, 237); "
                    (click)="addOption()">
                    <span><i class='bx bx-plus-medical' style='color:rgb(46, 170, 237);'></i></span>
                    Add Option</button>

            </div>




            <div class="card-footer mt-5">
                <button type="submit" class="btn btn-primary float-start" 
                   >

                    Save Question</button>
                <button class="btn  mx-4" [routerLink]="['/question/add']" routerLinkActive="router-link-active">

                    Cancel</button>
            </div>


        </form>
    </div>
</div>